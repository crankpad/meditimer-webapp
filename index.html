<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Medikamenten-Timer</title>
  <meta name="theme-color" content="#4CAF50">
  <style>
    :root {
      --bg: #f9f9f9;
      --text: #000;
      --card: #fff;
      --accent: #4CAF50;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --text: #ffffff;
      --card: #1e1e1e;
      --accent: #81c784;
    }
    * { box-sizing: border-box; }
    body {
      font-family: sans-serif;
      margin: 0;
      background-color: var(--bg);
      color: var(--text);
      padding: 1rem;
    }
    .container {
      max-width: 500px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    input, button {
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
    }
    input {
      background: var(--card);
      color: var(--text);
      border: 1px solid #ccc;
    }
    button {
      background: var(--accent);
      color: white;
      cursor: pointer;
    }
    #output, #historyLog {
      background: var(--card);
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 8px;
      white-space: pre-wrap;
    }
    .dark-toggle {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-size: 1.2rem;
      background: var(--accent);
      color: white;
      border: none;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 1rem;
      text-align: center;
      border-radius: 8px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Medikamenten-Timer</h2>
    <label>Zeit (optional):</label>
    <input type="time" id="time">
    <button onclick="handleMed('Ibuprofen')">Ibuprofen</button>
    <button onclick="handleMed('Paracetamol')">Paracetamol</button>
    <div id="output" style="display:none;"></div>
    <textarea id="hiddenTextArea" style="position:absolute;left:-9999px;"></textarea>
    <button onclick="copyToClipboard()">Text kopieren</button>

    <h3>Fieber erfassen</h3>
    <input type="number" step="0.1" min="34" max="44" id="feverInput" placeholder="Temperatur in Â°C">
    <button onclick="logFever()">Fieber speichern</button>
    <canvas id="feverChart" width="500" height="200"></canvas>
    <div id="historyLog"></div>

    <button onclick="exportData()">Exportieren</button>
    <button onclick="document.getElementById('fileInput').click()">Importieren</button>
    <input type="file" id="fileInput" accept=".txt" style="display:none" onchange="importData(event)">
    <div id="dropZone" ondrop="dropImport(event)" ondragover="event.preventDefault()">oder Datei hierher ziehen</div>
  </div>
  <button class="dark-toggle" onclick="toggleDarkMode()">ðŸŒ“</button>

  <script>
    const MEDS = { Ibuprofen: 6, Paracetamol: 3 };
    let feverData = JSON.parse(localStorage.getItem('feverData') || '[]');
    let latestMessage = "";

    function format(d) {
      return d.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
    }

    function handleMed(med) {
      let now = new Date();
      const input = document.getElementById("time").value;
      if (input) {
        const [h, m] = input.split(":");
        now.setHours(+h, +m, 0);
      }
const other = med === "Ibuprofen" ? "Paracetamol" : "Ibuprofen";
const medTime = new Date(now.getTime() + MEDS[med] * 3600000);
const otherTime = new Date(now.getTime() + 3 * 3600000); // Wechsel immer nach 3h
const nextMed = other;
const nextTime = otherTime;

latestMessage =
  `${med} wurde um ${format(now)} eingenommen.\n\n` +
  `NÃ¤chste Einnahme: ${nextMed} ab ${format(nextTime)}\n\n` +
  `Alle Einnahmezeiten:\n- Paracetamol: ab ${format(new Date(now.getTime() + MEDS["Paracetamol"] * 3600000))}` +
  `\n- Ibuprofen: ab ${format(new Date(now.getTime() + MEDS["Ibuprofen"] * 3600000))}`;      document.getElementById("output").textContent = latestMessage;
      document.getElementById("output").style.display = "block";
      saveLog(latestMessage);
    }

    function copyToClipboard() {
      const textarea = document.getElementById("hiddenTextArea");
      textarea.value = latestMessage;
      textarea.select();
      document.execCommand("copy");
      alert("Text kopiert!");
    }

    function logFever() {
      const val = parseFloat(document.getElementById("feverInput").value);
      if (!val || val < 34 || val > 44) return alert("UngÃ¼ltige Temperatur");
      const now = new Date();
      feverData.push([now.toISOString(), val]);
      localStorage.setItem("feverData", JSON.stringify(feverData));
      drawChart();
      saveLog(`Fieber gemessen: ${val}Â°C um ${format(now)}`);
      if (val >= 39.5) alert("Fieber Ã¼ber 39,5Â°C â€“ Medikamenteneinnahme empfohlen!");
    }

    function drawChart() {
      const canvas = document.getElementById("feverChart");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (feverData.length < 2) return;
      const times = feverData.map(e => new Date(e[0]).getTime());
      const temps = feverData.map(e => e[1]);
      const minTime = Math.min(...times);
      const maxTime = Math.max(...times);
      const minTemp = 34;
      const maxTemp = 42;
      ctx.beginPath();
      ctx.strokeStyle = "red";
      feverData.forEach((e, i) => {
        const x = ((new Date(e[0]).getTime() - minTime) / (maxTime - minTime)) * canvas.width;
        const y = canvas.height - ((e[1] - minTemp) / (maxTemp - minTemp)) * canvas.height;
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      });
      ctx.stroke();
    }

    function saveLog(text) {
      const div = document.getElementById("historyLog");
      const entry = document.createElement("div");
      entry.textContent = text;
      div.prepend(entry);
    }

    function toggleDarkMode() {
      const theme = document.documentElement.getAttribute("data-theme");
      document.documentElement.setAttribute("data-theme", theme === "dark" ? "light" : "dark");
    }

    function exportData() {
      const data = JSON.stringify(feverData);
      const blob = new Blob([data], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "feverdata.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importData(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = evt => {
        try {
          const data = JSON.parse(evt.target.result);
          if (Array.isArray(data)) {
            feverData = data;
            localStorage.setItem("feverData", JSON.stringify(data));
            drawChart();
            alert("Import erfolgreich.");
          }
        } catch {
          alert("Import fehlgeschlagen.");
        }
      };
      reader.readAsText(file);
    }

    function dropImport(e) {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      const reader = new FileReader();
      reader.onload = evt => {
        try {
          const data = JSON.parse(evt.target.result);
          if (Array.isArray(data)) {
            feverData = data;
            localStorage.setItem("feverData", JSON.stringify(data));
            drawChart();
            alert("Import erfolgreich (Drag & Drop).");
          }
        } catch {
          alert("Drag & Drop Import fehlgeschlagen.");
        }
      };
      reader.readAsText(file);
    }

    drawChart();
  </script>
</body>
</html>